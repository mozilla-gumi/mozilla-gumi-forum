<HTML>
<HEAD>
<TITLE>[CJ-Club]-[CGI]-[BBS]-Child Tree</TITLE>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=x-sjis">
<STYLE TYPE="text/css">
<!--
A:link { color:#747AF3; text-decoration:none; }
A:visited { color:#63BC73; text-decoration:none; }
A:hover { color:#F0764D; text-decoration:underline; }
BODY,TD{ font-family:"MS UI Gothic"; font-size:10pt; }
H3 { font-family:"Verdana"; font-size:13pt; color:#63C97C; }
B,TH { font-family:"ＭＳ Ｐゴシック"; font-size:11pt; }
PRE {color:#0000ff}
DIV {background-color:#A3E9B8;font-size:10pt;}
-->
</STYLE>
<META NAME=GENERATOR CONTENT="HOTALL Ver.4.0W">
</HEAD>
<BODY BGCOLOR="#cfff9b" TEXT="#3a3a3a">
<P>
<CENTER><TABLE>
<TR>
<TD>
<H3>

</H3>
</TD>
<TD>
<H3>
Child Tree
</H3>
</TD></TR></TABLE>ツリー式ファイルアップ掲示板<BR>
</CENTER><BR>
<DIV ALIGN=LEFT><B>■特徴とサンプル</B></DIV><BR>
</P>
<OL>
<LI>ツリー形式、トピック形式、スレッド形式の掲示板<BR>
<LI>上記どれを使うか指定でき、また3つ同時にも使用できる<BR>
<LI>クッキー対応<BR>
<LI>記事の削除、編集がオンラインでできる。レス記事の無い記事は完全の削除されレス記事のある記事はツリー保持のため記事の跡が残る<BR>
<LI>カウンタ機能付き（ON/OFF）<BR>
<LI>タグ使用可能（ON/OFF）<BR>
<LI>投稿者にレス記事を、管理者にすべての記事をメールで通知する（要 semdmail 機能-ON/OFF）<BR>
<LI>投稿者本人が自分の記事を削除・編集できる<BR>
<LI>IPアドレスを取得、記録/IPアドレスでアクセス制限<BR>
<LI>検索機能<BR>
<LI>過去ログ機能<BR>
<LI>簡易バックアップ機能（ON/OFF）<BR>
<LI>多目的に使えるチェックボックス機能と管理者のみチェック機能、解決後レス禁止機能<BR>
<LI>図表モード<BR>
<LI>レス数の制限<BR>
<LI>マルチ設定機能<BR>
<LI>親/レス記事ファイルアップ機能(ファイルアップ方法は<A HREF="http://tohoho.wakusei.ne.jp/">とほほ</A>さんのWWWUPLを参考にしています。)<BR>
</OL>
<P>
<BR>
<DIV ALIGN=LEFT><B>■規約</B></DIV><BR>
このCGI はフリーですが規定通りに使ってください。オリジナルスクリプトです。ということは、著作権欄を消さない限り再配布自由です。<BR>
Readme.txtもご覧ください。<BR>
<BR>
<DIV ALIGN=LEFT><B>■ファイル確認</B></DIV><BR>
<B>解凍 </B>したあと、以下のファイルがきちんとあるか確認してください。<BR>
</P>
<UL>
<LI>cbbs.cgi -メインプログラム<BR>
<LI>set.cgi -設定ファイル<BR>
<LI>srch.cgi - 検索 ＆過去ログ表示<BR>
<LI>cbbs.dat - メインログ<BR>
<LI>ccount.dat - カウンタログ<BR>
<LI>jcode.pl - 漢字コードライブラリ<BR>
<LI>rank.dat - 投稿ランクログ<BR>
<LI>cbbs.htm - このページによく似たマニュアル<BR>
<LI>klog.log - 過去ログカウント<BR>
<LI>Readme.txt - 簡易説明書<BR>
<LI>[file] -フォルダ<BR>
<LI>***.gif - 各種ヘッダ画像<BR>
</UL>
<P>
<BR>
<DIV ALIGN=LEFT><B>■設定変更</B></DIV><BR>
<FONT COLOR="#fe8f78"><B>最小限</B></FONT>の設定変更の説明です。<BR>
メモ帳などのエディタで[ cbbs.cgi ]のファイルを開いてください。<BR>
<BR>
<FONT COLOR="#ff8080"><B>1行目</B></FONT><BR>
</P>
<PRE>#!/usr/local/bin/perl</PRE>
<P>
これを正しいパスに書きなおしてください。だいたいのサーバではこのままでOKです。<BR>
<BR>
<CENTER><HR SIZE=1 WIDTH=70%>次に[ set.cgi ]をメモ帳などのエディタで開いてください。以下出てくる行数はすべて set.cgi です。</CENTER><BR>
<BR>
<FONT COLOR="#ff8080"><B>10行目</B></FONT><BR>
</P>
<PRE>$backurl=&quot;../index.html&quot;;</PRE>
<P>
MENU のリンク先です。つまりは戻るURLです。<BR>
<BR>
<BR>
<FONT COLOR="#ff8080"><B>11行目</B></FONT><BR>
</P>
<PRE>$pass  = &quot;7777&quot;;</PRE>
<P>
管理用パスワードです。変更してください。<BR>
<BR>
<BR>
<DIV ALIGN=LEFT><B>■記事タイトルのヘッダを指定</B></DIV><BR>
ツリー表示の際の記事タイトルの前につくヘッダを指定します。<BR>
</P>
<DL>
<DD><B>サンプルの場合</B><BR>
<DD><FONT COLOR="#ff8080"><B>50〜53行目</B></FONT><BR>
</DL>
<PRE>$hed_i= '&lt;img src=&quot;hed.gif&quot; height=15 width=15 border=0 alt=&quot;Nomal&quot;&gt;';
$new_i= '&lt;img src=&quot;new.gif&quot; height=15 width=15 border=0 alt=&quot;New&quot;&gt;';
$all_i= '&lt;img src=&quot;all.gif&quot; height=16 width=16 border=0 alt=&quot;All&quot;&gt;';
$up_i_= '&lt;img src=&quot;uph.gif&quot; height=15 width=15 border=0 alt=&quot;UpDate&quot;&gt;';</PRE>
<DL>
<DD><BR>
<DD>他にもそのままテキストで表現してしまうこともできる。<BR>
<DD><FONT COLOR="#ff8080"><B>50〜53行目</B></FONT><BR>
</DL>
<PRE>$all_i= '■';
$hed_i= '□';
$new_i= 'Ｎ';
$up_i_= 'UP';</PRE>
<DL>
<DD>とやると、親記事の先頭に ■ 各記事の先頭に □ 新着記事の先頭に Ｎ アップデート記事に UP が表示される。<BR>
</DL>
<P>
<BR>
<DIV ALIGN=LEFT><B>■ サーバに送る（テスト設置）</B></DIV><BR>
基本設定ができたら、サーバに送りましょう。ここでは[ public_html ]の下に<BR>
[ cbbs ]というディレクトリを作ってそこに送るという仮定で説明します。<BR>
</P>
<PRE>[public_html]┐
             ├ [cbbs] ┐（ロック機構/過去ログ機能/バックアップ機能を使う場合 [777]）
             │        ├ cbbs.cgi   [755]（このファイルにリンクを張ります）
             │        ├ cbbs.dat   [666]
             │        ├ set.cgi    [755]
             │        ├ srch.cgi   [755]
             │        ├ all.gif/hed.gif/new.gif/uph.gif（初期設定のまま画像でヘッダを指定する時）
             │        ├ jcode.pl   [755] (このファイルは他のCGIと共有できます)
             │        ├ ccount.dat [666] (このファイルはカウンタ機能を使う時必要)
             │        ├ rank.dat   [666] (このファイルは発言ランクを使うとき必要)
             │        ├ klog.log   [666] (このファイルは過去ログ機能を使う時必要)
             │        └ [file] ┐(パーミッション[777]/ファイルをアップするディレクトリ/機能を使う場合)
             │                  ├ *.gif / *.gif... (各ファイル形式の画像)
             │                  └ index.html (空でも良いのでなるべく入れて下さい)
             │
             └ index.html</PRE>
<P>
[　]内の数字は送るときの<B>パーミッション</B>です。<BR>
<TABLE BORDER>
<TR>
<TH>
ファイル名
</TH>
<TD>
モード
</TD>
<TD>
パーミッション
</TD></TR>
<TR>
<TH>
ファイルアップフォルダ
</TH>
<TD>
<BR></TD>
<TD>
777 or 755
</TD></TR>
<TR>
<TH>
cbbs.cgi/srch.cgi/set.cgi/jcode.pl
</TH>
<TD>
アスキー（テキスト）
</TD>
<TD>
755
</TD></TR>
<TR>
<TH>
cbbs.dat/ccount.dat/klog.log/rank.dat
</TH>
<TD>
アスキー（テキスト）
</TD>
<TD>
666
</TD></TR>
<TR>
<TH>
*.gif
</TH>
<TD>
バイナリー
</TD>
<TD>
特に無し
</TD></TR></TABLE><BR>
<BR>
<DIV ALIGN=LEFT><B>■解決済みチェックボックスの使用法</B></DIV><BR>
例えば質問コーナーで答えがわかったらその記事のよこに OK! と表示したり、<BR>
オークションだったら売約済みになったら記事のよこに 契約完了 といった表示を簡単に実現する。<BR>
</P>
<DL>
<DD><B>サンプルの場合</B><BR>
<DD><FONT COLOR="#ff8080"><B>55〜68行目</B></FONT><BR>
</DL>
<PRE>$end_f = 1;
$end_c = 0;
$end_e = 0;

# チェック時、表示する物(タグ可 画像の時は&lt;img&gt;タグ)
$end_ok= '&lt;font color=red&gt;解決済み!&lt;/font&gt;';

# チャックを促すコメント(例: 解決したらチェック！)
$end_m =&lt;&lt;&quot;_END_&quot;;

&lt;font color=red&gt;&lt;small&gt;解決したらチェックしてください!&lt;/small&gt;&lt;/color&gt;

_END_</PRE>
<DL>
<DD>使用目的は質問の謎が解けたら 解決済み! と表示する、という感じ。<BR>
<DD>$end_f を 1 にすればチェックボックスがレスフォームに表示され 0 だと表示されない。<BR>
<DD>$end_c を 1 にすると、管理モードの編集作業からしかチェックができなくなる（イタズラ防止）<BR>
<DD>$end_e を 1 にすると、解決記事は返信不可になります。<BR>
<DD>チェックすると $end_ok を表示する。タグも使えるので&lt;img&gt;タグで画像も指定できる。<BR>
<DD>チェックを促すコメントのところはタグも使えます。内容はチェックボックスのよこに表示されます。<BR>
<DD><BR>
</DL>
<P>
<BR>
<DIV ALIGN=LEFT><B>■過去ログ機能</B></DIV><BR>
この掲示板は簡単な過去ログ機能があります。<BR>
<BR>
<FONT COLOR="#ff8080"><B>170〜173行目</B></FONT><BR>
</P>
<PRE>$klog_s= 0;
$klog_c= &quot;./klog.log&quot;;
$klog_d= &quot;.&quot;;
$klog_l= 100;</PRE>
<P>
使用する場合は $klog_s を 1 にしてください。 $klog_d で過去ログを作るディレクトリを指定します。<BR>
$klog_l で過去ログの一つのファイルの限度サイズKB（キロバイト）数でを指定します。<BR>
（例えば 1.txt が100KBを越えたら 2.txt を生成しそっちに記録する）<BR>
srch.cgi の方にも同じような記述が <B>34行目</B>からあるので同じように設定してください。<BR>
<BR>
<FONT COLOR="#ff0000">* 過去ログ機能を使用するときは過去ログを生成するディレクトリのパーミッションを[ 777（もしくは755） ]に設定してください。</FONT><BR>
<FONT COLOR="#ff0000">* v4.1以上にバージョンアップの際、過去ログ機能の方式を通常ログと同時書きこみ→通常ログから削除時に書きこみへ変更したため、過去ログの記事がかぶる場合があります！</FONT><BR>
</P>
<UL>
記事保持数100の場合<BR>
v4.0以前-&gt;v4.1例)→現在までの親記事NO.200 通常ログにNO.100〜200、過去ログにNO.0〜200<BR>
→よって、4.1ではNO.100〜200をまた書いてしまうためNO.100〜200記事が重なります。対処法として、過去ログ機能を1時停止して、記事を調整する（NO.201の書きこみが最下部にくるまで中止）、過去ログからNO.100〜200を削除するのどちらかが有効です。<BR>
<BR>
過去ログの記事がかぶって良い場合は気にしなくてもOKですが…(^^;<BR>
</UL>
<P>
<BR>
<DIV ALIGN=LEFT><B>■メール通知機能</B></DIV><BR>
この掲示板は投稿があるとメールで通知する、レス記事を投稿者の任意で送信するという機能があります。<BR>
*この機能はsendmailが使えるサーバでしか使えません。sendmailが使えるかどうかは直接サーバ管理者にお問い合わせください。<BR>
<BR>
<FONT COLOR="#ff8080"><B>118〜123行目</B></FONT><BR>
</P>
<PRE>$t_mail= 0;
$mymail= 0;
$mailto= 'user@host.ne.jp';
$o_mail= 0;
$s_mail= '/usr/lib/sendmail';
$q_mail= 0;</PRE>
<P>
$t_mail の 0 を 1 に変えると投稿すべてを管理者に投稿機能が働くようになります。<BR>
$mymail を 1 にすると自分の投稿もメールで通知されますが 0 だと自分の投稿は自分に通知されません。<BR>
（メールアドレス記入欄に通知するアドレスと同じアドレスを記入した場合）<BR>
$mailto は通知をするメールアドレスです。あなたのメールアドレスをいれるとこです。カンマ(,)で区切っていくつも指定できます。<BR>
$o_mail を 1 にすると投稿者の任意でレス記事のメールの受信を設定できるようになります。<BR>
$s_mail はsendmailパスです。だいたいのサーバはこのままでOKですが、一応サーバ管理者にお問い合わせください。<BR>
$q_mail は sendmail互換のqmailの場合にカンマを半角の空白に置き換えます。<BR>
<BR>
<DIV ALIGN=LEFT><B>■タイトルを画像にする</B></DIV><BR>
タイトルに画像を使う事ができます。<BR>
<BR>
<FONT COLOR="#ff8080"><B>130行目</B></FONT><BR>
</P>
<PRE>$t_img = &quot;&quot;;</PRE>
<P>
ここにURLで画像のある場所を指定してください。縦と横のサイズ指定も忘れずに。すると題名の部分が画像に置きかえられます。<BR>
<BR>
<DIV ALIGN=LEFT><B>■カウンタを画像にする</B></DIV><BR>
カウンタに画像をつかうこともできます。<BR>
<BR>
<FONT COLOR="#ff8080"><B>134行目</B></FONT><BR>
</P>
<PRE>$cou  = 0;</PRE>
<P>
ここを 0 にするとカウンタ機能は働きません。 1 にすると動きます。カウンタに画像を使うには、<BR>
</P>
<PRE>0.gif / 1.gif 〜 8.gif / 9.gif</PRE>
<P>
のファイルを用意して 92行目 $m_pas に指定（最後のスラッシュ(/)は省く）したディレクトリにアップすればOK。<BR>
縦と横のサイズもきちんと指定しておきましょう。<BR>
<BR>
<DIV ALIGN=LEFT><B>■タグを使用可能にする</B></DIV><BR>
タグ（&lt;a&gt;&lt;font&gt;&lt;img&gt;&lt;b&gt;&lt;i&gt;など）を使用可能にできます。<BR>
<BR>
<FONT COLOR="#ff8080"><B>148行目</B></FONT><BR>
</P>
<PRE>$tag  =  0;</PRE>
<P>
ここの 0 を 1 にするとタグを使う事が出きるようになります。<BR>
<BR>
<DIV ALIGN=LEFT><B>■簡易バックアップ機能を使う</B></DIV><BR>
ログ消失対策にバックアップをとります。<BR>
<BR>
<FONT COLOR="#ff8080"><B>149/150行目</B></FONT><BR>
</P>
<PRE>$bup  =  0;
$bup_f= &quot;./cbbs.bak&quot;;</PRE>
<P>
$bup を 1 にすると、$bup_f にバックアップをとります。自動でファイルを作るのでファイルをアップする必要はありません。<BR>
<FONT COLOR="#ff0000">* もう一つログを取得するので合計で2倍の容量になります。</FONT><BR>
<FONT COLOR="#ff0000">* ファイルを生成するディレクトリのパーミッションを [777] に設定してください</FONT><BR>
<BR>
<DIV ALIGN=LEFT><B>■ファイルアップ機能</B></DIV><BR>
この掲示板の特徴であるファイルアップ機能を使う場合は、<BR>
<BR>
<FONT COLOR="#ff8080"><B>195〜201行目</B></FONT><BR>
</P>
<PRE>$i_mode= 1;

# ●相対パス/絶対パスでファイルアップする場所(ファイルアップ用)
$i_dir = &quot;./file&quot;;

# ●http:// のURLでファイルアップする場所(ファイル表示用)
$i_Url = &quot;http://www.---.com/cgi-bin/cbbs/file&quot;;</PRE>
<P>
$i_mode を 1 から 0 にするとファイルアップ機能は使いません。<BR>
$i_dir ファイルアップするディレクトリです。最後の スラッシュ（/） は入れないでください。相対パスか / からの絶対パスで指定します。<BR>
$i_Url はhttp://〜のURLで、$i_dir を指定します。ファイル表示用のURLなのでCGI起動パスなどではありません。<BR>
<BR>
　アップ可能ファイル形式はおそらくどんなのでも指定できると思いますが、サーバの設定、ブラウザのプラグイン等によってはアップできても表示は無理かもしれません。<BR>
　問題無く追加できると思われるほかの拡張子 .pdf/.sit/.cab/.htm/.html/.mp3/.mpeg/.rar/.bmp等<BR>
　また、通信環境などによっては大きなファイルが正常にアップできない場合があります。<BR>
<BR>
<DIV ALIGN=LEFT><B>■ 発言ランク</B></DIV><BR>
発言ランク機能が使えます。<BR>
<FONT COLOR="#ff8080"><B>157〜169行目</B></FONT><BR>
</P>
<PRE>$M_Rank= 1;
$RLOG = &quot;./rank.dat&quot;;
$RDEL = 30;
$RBEST = 30;
$RLOCK = &quot;./rank.loc&quot;;

# ●レベル設定 右に行くほど高い(設定しない場合は空行 @RLv=(); にする)
@RLv = (&quot;一般人&quot;,&quot;付き人&quot;,&quot;軍団&quot;,&quot;ファミリー&quot;,&quot;ベテラン&quot;,&quot;大御所&quot;);

$RSPL = 50;

# ●ランク外にする人の名前(ない場合は空行 @NoRank=(); にする)
@NoRank= (&quot;管理人の名前&quot;,&quot;りゅういち&quot;);</PRE>
<P>
$M_Rank を 1 にすると発言ランク機能が使えます。<BR>
$RLOG は発言ランクを記録するログファイルまでのパスです。同じディレクトリにログを入れる場合はこのままでOKです。<BR>
$RDEL は発言をランクから削除する日数を指定します。<BR>
$RBEST は発言ランクで表示するランキングの人数を指定します。<BR>
$RLOCK はランキング用のロックファイルのパスです。<BR>
@RLv はレベルの設定です。回数が多いほど右のレベルになっていきます。<BR>
$RSPL はレベルアップの区切り単位です。50だと50回で一般人から付き人へ、100回で付き人から軍団になれます。<BR>
@NoRank はランクからはずす人の名前を指定します。<BR>
<BR>
<FONT COLOR="#ff0000">*) 今までの発言ランク機能と違い、書き込んだ時点の回数、レベルが表示されます!</FONT><BR>
<BR>
<DIV ALIGN=LEFT><B>■その他</B></DIV><BR>
わからない、設置できない、バグがでた、などの情報は<B><A HREF="http://www.cj-c.com/sp/">サポート掲示板</A></B>までお願いします。<BR>
<BR>
<B>ChildTreeレンタル向け</B><BR>
<A HREF="http://labo.kiryuu.cx/">霧生ウェブ研究所</A><BR>
<BR>
</P>
</BODY>
</HTML>